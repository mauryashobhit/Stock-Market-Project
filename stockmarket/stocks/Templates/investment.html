<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portfolio Optimizer: Investment Module</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0e1117;
      color: #e2e8f0;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    header {
      background-color: #161b22;
      color: white;
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 1030;
      box-shadow: 0 2px 5px rgba(0,0,0,0.4);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    nav a {
      margin: 0 1rem;
      color: #c9d1d9;
      font-weight: 600;
      text-decoration: none;
      position: relative;
    }
    nav a:hover { color: #58a6ff; }
    nav a::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -4px;
      left: 0;
      background-color: #58a6ff;
      transition: width 0.3s ease;
    }
    nav a:hover::after { width: 100%; }
    .logo-link { color: inherit; text-decoration: none; }
    .card {
      background-color: #161b22;
      border: none;
      box-shadow: 0 6px 15px rgba(0,0,0,0.4);
      border-radius: 15px;
      margin: 1.5rem 0 0 0;
    }
    .card-header {
      background-color: transparent;
      border-bottom: none;
      color: #58a6ff;
      font-weight: 700;
      font-size: 1.3rem;
    }
    .result-table th, .result-table td {
      color: #e2e8f0;
      background-color: #0e1117;
      border: 1px solid #30363d;
      text-align: center;
      padding: 0.5rem;
    }
    .result-table th {
      color: #58a6ff;
    }
    .btn-primary {
      background-color: #21262d;
      border: 1px solid #30363d;
      color: #e2e8f0;
      font-weight: 700;
      transition: background-color 0.3s, color 0.3s;
    }
    .btn-primary:hover {
      background-color: #58a6ff;
      color: #0e1117;
    }
    canvas {
      width: 100% !important;
      max-height: 320px !important;
      background-color: #0d1117;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.6);
      margin-top: 1rem;
    }
    footer {
      text-align: center;
      padding: 1rem;
      background: #161b22;
      color: #8b949e;
      margin-top: 2rem;
    }
    label { color: white; }
    h5, h6 { color: white; }
  </style>
</head>
<body>
  <header>
    <h1><a href="{% url 'index' %}" class="logo-link">PORTFOLIO OPTIMIZER</h1>
    <nav>
      <a href="{% url 'niftychart' %}">Markets</a>
      <a href="{% url 'news' %}">News</a>
      <a href="{% url 'investment' %}">Portfolio</a>
      <a href="{% url 'screener' %}">Screener</a>
      <a href="{% url 'login' %}">Login</a>
    </nav>
  </header>
  <main class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="card p-4">
          <div class="card-header" align="center">Investment Module</div>
          <div class="card-body">
            <form id="investmentForm" class="row g-3 align-items-end">
              <div class="col-md-9">
                <label for="amount" class="form-label">Enter total investment amount (Rs):</label>
                <input type="number" min="1000" step="100" class="form-control" id="amount" placeholder="E.g. 10000" required />
              </div>
              <div class="col-md-3 d-grid">
                <button type="submit" class="btn btn-primary">Invest</button>
              </div>
            </form>
          </div>
          <div id="resultSection" class="card-body" style="display:none;">
            <h5 class="mb-3">Investment Distribution:</h5>
            <div class="table-responsive mb-4">
              <table class="table result-table">
                <thead>
                  <tr>
                    <th>Company</th>
                    <th>Ticker</th>
                    <th>Allocation (%)</th>
                    <th>Amount (Rs)</th>
                  </tr>
                </thead>
                <tbody id="allocationTable"></tbody>
              </table>
            </div>
            <div class="row mb-4">
              <div class="col-md-6">
                <h6>Portfolio Value Over Time</h6>
                <canvas id="lineChart"></canvas>
              </div>
              <div class="col-md-6">
                <h6>Investment Distribution</h6>
                <canvas id="pieChart"></canvas>
              </div>
            </div>
            <p class="text-success mt-3" align="center"><strong>Your amount is now invested in 10 leading US stocks. The line chart shows simulated portfolio growth over time.</strong></p>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer>
    &copy; 2025 StockVision. All rights reserved.
  </footer>
  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const COMPANIES = [
      { name: "Alphabet (Google)", ticker: "GOOGL" },
      { name: "Microsoft", ticker: "MSFT" },
      { name: "Cisco", ticker: "CSCO" },
      { name: "Amazon", ticker: "AMZN" },
      { name: "Apple", ticker: "AAPL" },
      { name: "Adobe", ticker: "ADBE" },
      { name: "Meta Platforms", ticker: "META" },
      { name: "Netflix", ticker: "NFLX" },
      { name: "Walmart", ticker: "WMT" },
      { name: "JP Morgan Chase", ticker: "JPM" }
    ];
    const COLORS = [
      "#4285F4", // Google (strong blue)
      "#F25022", // Microsoft (orange)
      "#27C1A3", // Cisco (teal)
      "#FFB300", // Amazon (gold)
      "#A2AAAD", // Apple (gray)
      "#FF26B9", // Adobe (magenta pink)
      "#3A86FF", // Meta (deep blue)
      "#E50914", // Netflix (red)
      "#0071CE", // Walmart (blue)
      "#32CD32"  // JP Morgan (lime green)
    ];

    function getRandomAllocations(numStocks) {
      let randoms = Array.from({ length: numStocks }, () => Math.random());
      let sum = randoms.reduce((a, b) => a + b, 0);
      let allocs = randoms.map(r => +(r / sum * 100).toFixed(1));
      let diff = +(100 - allocs.reduce((a, b) => a + b, 0)).toFixed(1);
      allocs[0] += diff;
      return allocs;
    }

    function calcAmounts(alloc, total) {
      return alloc.map(p => ((p/100) * total));
    }

    // Simulate 1 year (252 trading days) of portfolio values with random-walk growth
    function simulatePortfolioGrowth(amounts, periods=252) {
      let dailyReturns = COMPANIES.map(_ =>
        Array.from({length: periods}, () =>
          (Math.random() * 0.03 - 0.01)  // -1% to +2%
        )
      );
      let priceSeries = dailyReturns.map(draws => {
        let arr = [1];
        for(let i=0; i<draws.length; i++)
          arr.push(arr[arr.length - 1] * (1 + draws[i]));
        return arr;
      });
      let portfolio = [];
      for(let t=0; t <= periods; t++) {
        let total = 0;
        for(let s=0; s<COMPANIES.length; s++) {
          total += amounts[s] * priceSeries[s][t];
        }
        portfolio.push(Math.round(total));
      }
      return portfolio;
    }

    let lineChart = null;
    let pieChart = null;

    document.getElementById("investmentForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const totalAmount = parseFloat(document.getElementById("amount").value);
      if (isNaN(totalAmount) || totalAmount < 1000) return;

      let allocations = getRandomAllocations(COMPANIES.length);
      let amounts = calcAmounts(allocations, totalAmount).map(a => Math.round(a));

      const tbody = document.getElementById("allocationTable");
      tbody.innerHTML = "";
      for(let i=0; i<COMPANIES.length; i++) {
        tbody.innerHTML += `
          <tr>
            <td>${COMPANIES[i].name}</td>
            <td>${COMPANIES[i].ticker}</td>
            <td>${allocations[i].toFixed(1)}%</td>
            <td>${amounts[i].toLocaleString('en-IN', {style:'currency', currency:'INR'})}</td>
          </tr>`;
      }
      document.getElementById("resultSection").style.display = "";

      const portfolioHistory = simulatePortfolioGrowth(amounts, 252);
      const ctxLine = document.getElementById('lineChart').getContext('2d');
      if (lineChart) lineChart.destroy();
      lineChart = new Chart(ctxLine, {
        type: 'line',
        data: {
          labels: Array.from({length: portfolioHistory.length}, (_, i) => `Day ${i + 1}`),
          datasets: [{
            label: 'Portfolio Value (Rs)',
            data: portfolioHistory,
            backgroundColor: 'rgba(88,166,255,0.16)',
            borderColor: '#58a6ff',
            borderWidth: 2,
            fill: true,
            pointRadius: 0
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#c9d1d9', font: { weight: 'bold' } } }
          },
          scales: {
            x: { ticks: { color: '#c9d1d9' } },
            y: { ticks: { color: '#c9d1d9' }, beginAtZero: true }
          }
        }
      });

      const ctxPie = document.getElementById('pieChart').getContext('2d');
      if (pieChart) pieChart.destroy();
      pieChart = new Chart(ctxPie, {
        type: 'pie',
        data: {
          labels: COMPANIES.map(c => c.ticker),
          datasets: [{
            data: amounts,
            backgroundColor: COLORS,
            borderWidth: 2,
            borderColor: '#0e1117'
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: '#c9d1d9', font: { weight: 'bold' } } }
          }
        }
      });
    });
  </script>
</body>
</html>
