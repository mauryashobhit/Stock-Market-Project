<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portfolio Optimizer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0e1117;
      color: #e2e8f0;
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    header {
      background-color: #161b22;
      color: white;
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 1030;
      box-shadow: 0 2px 5px rgba(0,0,0,0.4);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    nav a {
      margin: 0 1rem;
      color: #c9d1d9;
      font-weight: 600;
      text-decoration: none;
      position: relative;
    }
    nav a:hover { color: #58a6ff; }
    nav a::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -4px;
      left: 0;
      background-color: #58a6ff;
      transition: width 0.3s ease;
    }
    nav a:hover::after { width: 100%; }
    .logo-link { color: inherit; text-decoration: none; }
    .card {
      background-color: #161b22;
      border: none;
      box-shadow: 0 6px 15px rgba(0,0,0,0.4);
      border-radius: 15px;
      margin: 1.5rem 0 0 0;
    }
    .card-header {
      background-color: transparent;
      border-bottom: none;
      color: #58a6ff;
      font-weight: 700;
      font-size: 1.3rem;
    }
    .result-table th, .result-table td {
      color: #e2e8f0;
      background-color: #0e1117;
      border: 1px solid #30363d;
      text-align: center;
      padding: 0.5rem;
    }
    .result-table th {
      color: #58a6ff;
    }
    .btn-primary {
      background-color: #21262d;
      border: 1px solid #30363d;
      color: #e2e8f0;
      font-weight: 700;
      transition: background-color 0.3s, color 0.3s;
    }
    .btn-primary:hover {
      background-color: #58a6ff;
      color: #0e1117;
    }
    canvas {
      width: 100% !important;
      max-height: 320px !important;
      background-color: #0d1117;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.6);
      margin-top: 1rem;
    }
    footer {
      text-align: center;
      padding: 1rem;
      background: #161b22;
      color: #8b949e;
      margin-top: 2rem;
    }
    label
    {
      color:white;
    }
    h5
    {
      color:white;
    }
  </style>
</head>
<body>
  
   <header>
    <h1><a href="{% url 'index' %}" class="logo-link">PORTFOLIO OPTIMIZER</h1>
    <nav>
      <a href="{% url 'niftychart' %}">Markets</a>
      <a href="{% url 'news' %}">News</a>
      <a href="#">Portfolio</a>
      <a href="#">Screener</a>
      <a href="{% url 'login' %}">Login</a>
    </nav>
  </header>
  <main class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card p-4">
          <div class="card-header" align="center">Investment Optimizer</div>
          <div class="card-body">
            <form id="investmentForm" class="row g-3 align-items-end">
              <div class="col-md-9">
                <label for="amount" class="form-label">Enter total investment amount (Rs):</label>
                <input type="number" min="1000" step="100" class="form-control" id="amount" placeholder="E.g. 10000" required />
              </div>
              <div class="col-md-3 d-grid">
                <button type="submit" class="btn btn-primary">Optimize</button>
              </div>
            </form>
          </div>
          <div id="resultSection" class="card-body" style="display:none;">
            <h5 class="mb-3" >Suggested Allocation:</h5>
            <div class="table-responsive mb-4">
              <table class="table result-table">
                <thead>
                  <tr>
                    <th>Company</th>
                    <th>Ticker</th>
                    <th>Allocation (%)</th>
                    <th>Amount (Rs)</th>
                  </tr>
                </thead>
                <tbody id="allocationTable"></tbody>
              </table>
            </div>
            <canvas id="pieChart"></canvas>
            <p class="text-success mt-3" align="center"><strong>This allocation aims to maximize returns and minimize risk among top US stocks.</strong></p>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer>
    &copy; 2025 StockVision. All rights reserved.
  </footer>
  <!-- Bootstrap Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const COMPANIES = [
      { name: "Alphabet (Google)", ticker: "GOOGL" },
      { name: "Microsoft", ticker: "MSFT" },
      { name: "Cisco", ticker: "CSCO" },
      { name: "Amazon", ticker: "AMZN" },
      { name: "Apple", ticker: "AAPL" },
      { name: "Adobe", ticker: "ADBE" },
      { name: "Meta Platforms", ticker: "META" },
      { name: "Netflix", ticker: "NFLX" },
      { name: "Walmart", ticker: "WMT" },
      { name: "JP Morgan Chase", ticker: "JPM" }
    ];

    const COLORS = [
    "#4285F4", // Google (strong blue)
    "#F25022", // Microsoft (orange)
    "#27C1A3", // Cisco (teal)
    "#FFB300", // Amazon (amber/gold)
    "#A2AAAD", // Apple (soft gray)
    "#FF26B9", // Adobe (magenta pink)
    "#3A86FF", // Meta (deep blue)
    "#E50914", // Netflix (red)
    "#0071CE", // Walmart (medium blue)
    "#32CD32"  // JP Morgan (lime green)
  ];

    function randomAllocations(numStocks) {
      // Generate random allocations that sum to 100%
      let x = Array.from({length: numStocks}, () => Math.random());
      const sum = x.reduce((a,b) => a+b, 0);
      return x.map(v => v / sum * 100);
    }

    function calcAmounts(alloc, total) {
      return alloc.map(p => ((p/100) * total));
    }

    let pieChart = null;

    document.getElementById("investmentForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const totalAmount = parseFloat(document.getElementById("amount").value);
      if (isNaN(totalAmount) || totalAmount <= 0) return;

      // Simulate optimizer (replace with real optimization later)
      let allocations = randomAllocations(COMPANIES.length).map(a => Math.round(a*10)/10);
      // ensure sum is exactly 100
      let diff = 100 - allocations.reduce((a,b) => a+b,0);
      allocations[0] += diff;

      let amounts = calcAmounts(allocations, totalAmount).map(a=>Math.round(a));

      // Populate table
      const tbody = document.getElementById("allocationTable");
      tbody.innerHTML = "";
      for(let i=0; i<COMPANIES.length; i++) {
        tbody.innerHTML += `
          <tr>
            <td>${COMPANIES[i].name}</td>
            <td>${COMPANIES[i].ticker}</td>
            <td>${allocations[i].toFixed(1)}%</td>
            <td>${amounts[i].toLocaleString('Rs')}</td>
          </tr>`;
      }
      // Show section
      document.getElementById("resultSection").style.display = "";

      // Pie chart
      const ctx = document.getElementById('pieChart').getContext('2d');
      if (pieChart) pieChart.destroy();
      pieChart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: COMPANIES.map(c=>c.ticker),
          datasets: [{
            data: allocations,
            backgroundColor: COLORS,
            borderWidth: 2,
            borderColor: '#0e1117',
          }],
        },
        options: {
          plugins: {
            legend: {
              labels: { color: '#c9d1d9', font: { weight: 'bold' } },
            },
            tooltip: { enabled: true },
          },
        },
      });
    });
  </script>
</body>
</html>
